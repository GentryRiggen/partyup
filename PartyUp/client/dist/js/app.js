!function(){"use strict";angular.module("partyUp",["ui.router","ngAnimate","ngAria","ngMaterial"])}(),function(){"use strict";var e=angular.module("partyUp");e.constant("API_URL","/api"),e.value("toastr",toastr),e.value("moment",moment),e.value("$",$),e.run(["$rootScope","$state","UserService","$window","$location","AuthTokenService",function(e,t,n,i,o,a){e.$on("$viewContentLoaded",function(e){}),e.$on("$stateChangeStart",function(e,i,o){angular.isDefined(i.data)&&angular.isDefined(i.data.requireLogin)&&i.data.requireLogin===!1||a.getTokenAsync().then(function(){n.getCurrentUser().then(function(n){var o=!1;if(angular.forEach(n.roles,function(e){"Admin"===e&&(o=!0)}),!o&&angular.isDefined(i.data)&&angular.isDefined(i.data.allowedRoles)&&i.data.allowedRoles.length>0){var a=!1;angular.forEach(i.data.allowedRoles,function(e){angular.forEach(n.roles,function(t){e===t&&(a=!0)})}),a||(e.preventDefault(),t.go("login"))}},function(){e.preventDefault(),t.go("login")})})})}]),e.config(["$urlRouterProvider","$stateProvider","$httpProvider","$mdThemingProvider",function(e,t,n,i){e.otherwise("/"),t.state("about",{url:"/about",templateUrl:"/client/app/about/about.tmpl.html",controller:"AboutCtrl",controllerAs:"About",data:{requireLogin:!1}}).state("communities",{url:"/",templateUrl:"/client/app/community/communities.tmpl.html",controller:"CommunitiesCtrl",controllerAs:"Communities",data:{requireLogin:!1}}).state("community",{url:"/community/{communityId}",templateUrl:"/client/app/community/community.tmpl.html",controller:"CommunityCtrl",controllerAs:"Community",data:{requireLogin:!1}}).state("mission",{url:"/community/{communityId}/missions/{missionId}?host",templateUrl:"/client/app/mission/mission.tmpl.html",controller:"MissionCtrl",controllerAs:"Mission",data:{requireLogin:!1}}).state("event",{url:"/communities/{communityId}/missions/{missionId}/event/{eventId}",templateUrl:"/client/app/event/event.tmpl.html",controller:"EventCtrl",controllerAs:"Event",data:{requireLogin:!0}}).state("login",{url:"/login",templateUrl:"/client/app/login/login.tmpl.html",controller:"LoginCtrl",controllerAs:"Login",data:{requireLogin:!1}}).state("logout",{url:"/logout",controller:"LogoutCtrl",data:{requireLogin:!1}}).state("register",{url:"/register",templateUrl:"/client/app/register/register.tmpl.html",controller:"RegisterCtrl",controllerAs:"Register",data:{requireLogin:!1}}).state("account",{url:"/account",templateUrl:"/client/app/account/account.tmpl.html",controller:"AccountCtrl",controllerAs:"Account",data:{requireLogin:!0}}).state("admin",{url:"/admin",templateUrl:"/client/app/admin/admin.tmpl.html",controller:"AdminCtrl",controllerAs:"Admin",data:{allowedRoles:["Moderator"]}}).state("admin.communities",{url:"/communities",templateUrl:"/client/app/community/communities.admin.tmpl.html",controller:"CommunitiesAdminCtrl",controllerAs:"CommunitiesAdmin"}).state("admin.community",{url:"/communities/{communityId}",templateUrl:"/client/app/community/community.admin.tmpl.html",controller:"CommunityAdminCtrl",controllerAs:"CommunityAdmin"}).state("admin.mission",{url:"/communities/{communityId}/missions/{missionId}",templateUrl:"/client/app/mission/mission.admin.tmpl.html",controller:"MissionAdminCtrl",controllerAs:"MissionAdmin"}),n.interceptors.push("AuthInterceptor"),i.definePalette("primary",{50:"#e6eaed",100:"#b5c1c8",200:"#8397a4",300:"#5a7486",400:"#305267",500:"#072f49",600:"#062940",700:"#052337",800:"#041d2e",900:"#041825",A100:"#b5c1c8",A200:"#8397a4",A400:"#305267",A700:"#052337"}),i.theme("default").primaryPalette("primary")}])}(),function(){"use strict";function e(e,t,n){var i=this;t.updateTitle("About Party Up"),i.user={name:"",email:"",message:""},i.submit=function(){e.post(n+"/misc/sendfeedback",i.user).then(function(){t.showAlert("success","Feedback Sent!","")},function(){t.showAlert("error","Uh Oh!","Unable to send feedback. Please try again.")})}}angular.module("partyUp").controller("AboutCtrl",e),e.$inject=["$http","AlertService","API_URL"]}(),function(){"use strict";function e(e,t,n){function i(){n.updateTitle("My Account"),n.showLoading("Getting Account..."),t.getCurrentUser().then(function(e){o.user=e,n.hideLoading()},function(){n.hideLoading(),n.showAlert("error","Error","Unable to to get account")})}var o=this;i(),o.usernameOk=!0,o.checkUsername=function(e){t.checkUsername(e,!0).then(function(e){o.usernameOk="OK"===e.data?!0:!1},function(){o.usernameOk=!1})},o.emailOk=!0,o.checkEmail=function(e){t.checkEmail(e,!0).then(function(e){o.emailOk="OK"===e.data?!0:!1},function(){o.emailOk=!1})},o.update=function(){t.updateUser(o.user).then(function(){n.showAlert("success","Account Updated!","")},function(){n.showAlert("error","Uh Oh!","Could not update your account")})}}angular.module("partyUp").controller("AccountCtrl",e),e.$inject=["$state","UserService","AlertService"]}(),function(){"use strict";function e(e){function t(){n.selectedState=!1,angular.forEach(n.sections,function(t){n.selectedState||t.state!==e.current.name||(n.selectedState=t)}),n.selectedState||(n.selectedState=n.sections[0]),"admin"===e.current.name&&n.goTo(n.selectedState)}var n=this;n.sections=[{title:"Communities",state:"admin.communities"}],n.goTo=function(t){n.selectedState=t,e.go(t.state)},t()}angular.module("partyUp").controller("AdminCtrl",e),e.$inject=["$state"]}(),function(){"use strict";function e(e,t,n){var i={};return i.showLoading=function(t){var n="Loading...";angular.isDefined(t)&&(n=t===!1?"":t),e.alert={loading:{message:n,show:!0}}},i.hideLoading=function(){t(function(){e.alert.loading.show=!1},500)},n.options={closeButton:!1,debug:!1,newestOnTop:!0,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},i.showAlert=function(e,t,i){switch(e){case"success":n.success(t,i);break;case"info":n.info(t,i);break;case"warning":n.warning(t,i);break;case"error":n.error(t,i)}},i.updateTitle=function(t){e.$broadcast("partyUp.header.updateTitle",t)},i.updateGoBack=function(t){e.$broadcast("partyUp.header.updateBack",t)},i}angular.module("partyUp").service("AlertService",e),e.$inject=["$rootScope","$timeout","toastr"]}(),function(){"use strict";function e(e,t,n){return{request:function(e){var t=n.getToken();return t&&(e.headers.Authorization="Bearer "+t),e},response:function(e){return e},responseError:function(e){return t.reject(e)}}}angular.module("partyUp").factory("AuthInterceptor",e),e.$inject=["$location","$q","AuthTokenService"]}(),function(){"use strict";function e(e,t,n){var i="partyUp-Token",o=e.localStorage,a={};return a.getTokenAsync=function(){var e=n.defer();return t.userToken||(t.userToken=o.getItem(i)),e.resolve(t.userToken),e.promise},a.getToken=function(){return t.userToken||(t.userToken=o.getItem(i)),t.userToken},a.setToken=function(e){o.setItem(i,e)},a.hasToken=function(){return!!a.getToken()},t.$on("partyUp.user.logout",function(){t.userToken=void 0,o.removeItem(i)}),t.$on("partyUp.user.login",function(e,t){a.setToken(t.token)}),a}angular.module("partyUp").service("AuthTokenService",e),e.$inject=["$window","$rootScope","$q"]}(),function(){"use strict";function e(e,t){var n=t+"/files",i={};return i.uploadFile=function(t){var i=new FormData;return i.append("file",t),e.post(n,i,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity})},i.deleteFile=function(t){return e["delete"](n+"?fileName="+encodeURI(t))},i}angular.module("partyUp").service("FilesService",e),e.$inject=["$http","API_URL"]}(),function(){"use strict";function e(){return function(e,t){var n=[];return angular.forEach(e,function(e){var i;i=angular.isDefined(e.platform)?e.platform:e.Platform,("*"===t||t===i)&&n.push(e)}),n}}angular.module("partyUp").filter("platformFilter",e)}(),function(){"use strict";function e(e,t,n,i){var o={};return o.getHub=function(t){var n={token:e.getToken()};i.connection.hub.qs=n;var o=i.connection[t];return angular.isDefined(o)?o:!1},o.connected=!1,o.startConnection=function(){var e=t.defer();return i.connection.hub.start().done(function(){o.connected=!0,e.resolve("Connected")}),e.promise},o.disconnect=function(){i.connection.hub.stop(),o.connected=!1},n.$on("$stateChangeStart",function(e,t,n){o.connected&&o.disconnect()}),o}angular.module("partyUp").service("SignalRService",e),e.$inject=["AuthTokenService","$q","$rootScope","$"]}(),function(){"use strict";function e(e,t,n,i,o,a){var r={};return r.getCurrentUser=function(){var t=o.defer();return angular.isUndefined(i.currentUser)?n.get(e+"/auth/user").then(function(e){i.currentUser=e.data,t.resolve(i.currentUser)},function(e){t.reject()}):t.resolve(i.currentUser),t.promise},r.logout=function(){i.$broadcast("partyUp.user.logout"),i.currentUser=void 0},r.login=function(t,a){var r=o.defer();return n.post(e+"/auth",{username:t,password:a}).then(function(e){console.log(e.data),i.currentUser=e.data,i.$broadcast("partyUp.user.login",e.data),r.resolve(e.data)},function(e){r.reject("Invalid Login Attempt")}),r.promise},r.isAuthenticated=function(){return angular.isDefined(i.currentUser)},r.userHasAccess=function(e){return angular.forEach(i.currentUser.roles,function(t){return t===e?!0:void 0}),!1},r.register=function(t){return n.post(e+"/auth/register",t).then(function(e){i.currentUser=e.data,i.$broadcast("partyUp.user.login",e.data)})},r.updateUser=function(t){return n.put(e+"/auth/update",t)},r.checkUsername=function(t,i){return n.get(angular.isDefined(i)&&i===!0?e+"/auth/checkusername/loggedin?username="+t:e+"/auth/checkusername?username="+t)},r.checkEmail=function(t,i){return n.get(angular.isDefined(i)&&i===!0?e+"/auth/checkemail/loggedin?email="+t:e+"/auth/checkemail?email="+t)},r.showLoginModal=function(e){return a.show({controller:function(e,t,n){e.user={username:"",password:""},e.cancel=function(){t.cancel()},e.submit=function(){r.login(e.user.username,e.user.password).then(function(e){t.hide(e)},function(){e.cancel()})},e.createAccount=function(){n.go("register"),e.cancel()}},templateUrl:"/client/app/common/loginModal.tmpl.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})},r}angular.module("partyUp").service("UserService",e),e.$inject=["API_URL","$window","$http","$rootScope","$q","$mdDialog"]}(),function(){"use strict";function e(e,t,n){function i(){n.updateTitle("Admin - Communities"),o()}function o(){n.showLoading("Fetching Communities..."),t.getAll().then(function(e){n.hideLoading(),a.communities=e.data.communities},function(){n.hideLoading(),n.showAlert("error","Uh Oh","Failed to get communities")})}var a=this;a.communities=[],a.goToCommunity=function(t){e.go("admin.community",{communityId:t.id})},a.createNew=function(){n.showAlert("info","Creating new Community",""),t.createNew().then(function(e){a.goToCommunity(e.data)},function(){n.showAlert("error","Failed","Failed to create new community")})},i()}angular.module("partyUp").controller("CommunitiesAdminCtrl",e),e.$inject=["$state","CommunitiesService","AlertService"]}(),function(){"use strict";function e(e,t,n){function i(){n.updateTitle("Communities"),o()}function o(){n.showLoading("Fetching Communities..."),t.getAll().then(function(e){n.hideLoading(),a.communities=e.data.communities},function(){n.hideLoading(),n.showAlert("error","Uh Oh","Failed to get communities")})}var a=this;a.communities=[],a.goToCommunity=function(t){e.go("community",{communityId:t.id})},i()}angular.module("partyUp").controller("CommunitiesCtrl",e),e.$inject=["$state","CommunitiesService","AlertService"]}(),function(){"use strict";function e(e,t,n){var i={};return i.url=e+"/communities",i.getAll=function(){return t.get(i.url)},i.getById=function(e){return t.get(i.url+"/"+e)},i.update=function(e){return t.put(i.url+"/"+e.id,e)},i.createNew=function(){return t.post(i.url+"/createnew",{name:"New Community",description:"",logoUrl:"",bannerUrl:"",createdOn:new Date,modifiedOn:new Date})},i["delete"]=function(e){return t["delete"](i.url+"/"+e)},i}angular.module("partyUp").service("CommunitiesService",e),e.$inject=["API_URL","$http","$q"]}(),function(){"use strict";function e(e,t,n,i,o,a,r){function s(){n.showLoading("Fetching community..."),n.updateTitle("Admin - Communiy..."),n.updateGoBack(l),e.getById(i.communityId).then(function(e){n.hideLoading(),m.community=e.data,n.updateTitle("Admin - "+m.community.name),c()},function(){n.hideLoading(),n.showAlert("error","Uh oh","Could not find community")})}function l(){r.go("admin.communities")}function c(){t.getAllByCommunity(m.community.id).then(function(e){m.missions=e.data.missions},function(){n.showAlert("error","Failed","Failed to get missions")})}var m=this;m.modelOptions={debounce:{"default":500,blur:0}},m.goToMission=function(e){r.go("admin.mission",{communityId:i.communityId,missionId:e.id})},m.createNewMission=function(){n.showLoading("Creating Mission..."),t.createNew(m.community.id).then(function(e){n.hideLoading(),m.goToMission(e.data)},function(){n.hideLoading(),n.showAlert("error","Uh Oh","Failed to create mission")})},m.uploadFile=function(e,t){n.showAlert("info","Upload Started",""),o.uploadFile(e[0]).then(function(e){switch(t){case"logo":m.community.logoUrl=e.data[0].uri;break;case"banner":m.community.bannerUrl=e.data[0].uri}m.update()},function(){n.showAlert("error","Failed","Failed to upload file")})},m.update=function(){e.update(m.community).then(function(e){n.showAlert("success","Success","Community Updated")},function(){n.showAlert("error","Error","Community could not be updated")})},m["delete"]=function(){var t=a.confirm().parent(angular.element(document.body)).title("Are you sure?").content("Are you sure you want to delete this community?").ariaLabel("Delete Community").ok("OK").cancel("Cancel").targetEvent(event);a.show(t).then(function(){e["delete"](m.community.id).then(function(){n.showAlert("success","Success!","Community has been deleted"),r.go("admin.communities")},function(e){n.showAlert("error","Failed","Failed to delete community")})})},s()}angular.module("partyUp").controller("CommunityAdminCtrl",e),e.$inject=["CommunitiesService","MissionsService","AlertService","$stateParams","FilesService","$mdDialog","$state"]}(),function(){"use strict";function e(e,t,n,i,o){function a(){n.updateTitle("Communiy..."),n.updateGoBack(s),n.showLoading("Fetching community..."),e.getById(i.communityId).then(function(e){n.showLoading("Fetching Missions..."),l.community=e.data,n.updateTitle(l.community.name),r()},function(){n.hideLoading(),n.showAlert("error","Uh oh","Could not find community")})}function r(){t.getAllByCommunity(l.community.id).then(function(e){l.missions=e.data.missions,n.hideLoading()},function(){n.showAlert("error","Failed","Failed to get missions")})}function s(){o.go("communities")}var l=this;l.missions=!1,l.search=function(e){t.search(l.community.id,e).then(function(e){l.missions=e.data.missions},function(){n.showAlert("error","Failed","Failed to search missions")})},l.goToMission=function(e){o.go("mission",{communityId:i.communityId,missionId:e.id})},a()}angular.module("partyUp").controller("CommunityCtrl",e),e.$inject=["CommunitiesService","MissionsService","AlertService","$stateParams","$state"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{community:"=community",whenClicked:"&"},templateUrl:"/client/app/community/communityCard.tmpl.html",link:function(e,t,n){e.clicked=function(){e.whenClicked()(e.community)}}}}angular.module("partyUp").directive("communityCard",e),e.$inject=[]}(),function(){"use strict";function e(e,t,n,i,o,a,r,s,l){function c(){n.updateTitle("Event"),n.updateGoBack(d),n.showLoading("Fetching Event Details..."),o.getCurrentUser().then(function(e){p.currentUser=e,i.startConnection().then(function(){g.server.joinEventGroup(m())})})}function m(){return a.missionId+"-"+a.eventId}function u(){n.showAlert("warning","Still Connecting","Please try again in a few moments")}function d(){r.go("mission",{communityId:a.communityId,missionId:a.missionId})}var p=this;p.chatMessages=[],p.participants=[];var g=i.getHub("events");p.status="Looking for more",p.currentUser=!1;var h=!1;g.client.successfullyJoinedGroup=function(e){h=!0,p.event=e,p.event.organizer.id===p.currentUser.user.id?l.$broadcast("partyup.hostedEvent",p.event):l.$broadcast("partyup.joinedEvent",p.event),n.updateTitle(p.event.organizer.username+" - "+p.event.mission.name),n.hideLoading()},g.client.failedToJoinGroup=function(e){n.hideLoading(),n.showAlert("error","","Looks like that event has closed. Please try another or host your own."),d()},g.client.newMessage=function(t,i){p.chatMessages.push({from:t,message:i}),p.currentUser&&p.currentUser.user.firstName!==t&&n.showAlert("info",t+" sent a message",""),e.$apply()},g.client.userJoined=function(t){var i=!1;angular.forEach(p.event.eventParticipants,function(e){i||t.id!==e.id||(i=!0)}),i||t.id===p.event.organizer.id||(p.event.eventParticipants.push(t),n.showAlert("success","New Teammate",t.username+" joined!"),p.event.eventParticipants.length===p.event.desiredAmount&&(p.status="Closed")),e.$apply()},g.client.userLeft=function(t){for(var i=0;i<p.event.eventParticipants.length;i++)if(p.event.eventParticipants[i].id===t.id){p.event.eventParticipants.splice(i,1),n.showAlert("warning","Teammate Left",t.username+" Left :("),e.$apply();break}t.id===p.event.organizer.Id&&(n.showAlert("warning","Event Ended","The organizer has left the event."),d())},p.newMessage="",p.addNewMessage=function(){h||u(),i.connected?(g.server.sendMessage(p.newMessage,m()),p.newMessage=""):u()},p.showXBLInfo=function(e){window.open("https://account.xbox.com/Messages?gamerTag="+e.xblTag,"_blank")},c()}angular.module("partyUp").controller("EventCtrl",e),e.$inject=["$scope","EventsService","AlertService","SignalRService","UserService","$stateParams","$state","$mdDialog","$rootScope"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{event:"=",whenClicked:"&"},templateUrl:"/client/app/event/eventCard.tmpl.html",link:function(e,t,n){e.clicked=function(){e.whenClicked()(e.event)}}}}angular.module("partyUp").directive("eventCard",e),e.$inject=[]}(),function(){"use strict";function e(e,t){var n={},i=e+"/missions",o=e+"/events";return n.getAllByMission=function(e){return t.get(i+"/"+e+"/events")},n.getById=function(e){return t.get(o+"/"+e)},n}angular.module("partyUp").service("EventsService",e),e.$inject=["API_URL","$http"]}(),function(){"use strict";function e(e,t,n,i,o){function a(){t.getCurrentUser().then(function(e){r(e)},function(){r()})}function r(e){angular.isDefined(e)?(s.currentUser=e,angular.forEach(s.currentUser.roles,function(e){("Admin"===e||"Moderator"===e)&&(s.showModerator=!0)})):(s.currentUser=!1,s.showModerator=!1)}var s=this;s.currentUser=!1,s.showModerator=!1,s.navigate=function(e){i("sideNav").close(),n.go(e)},s.toggleNav=function(){i("sideNav").toggle()},e.$on("partyUp.user.login",function(e,t){r(t)}),e.$on("partyUp.user.logout",function(){r()}),s.title="Party Up",e.$on("partyUp.header.updateTitle",function(e,t){angular.isDefined(t)&&""!==t&&(s.title=t)}),s.goBack=!1,e.$on("partyUp.header.updateBack",function(e,t){s.goBack=angular.isDefined(t)?t:!1}),e.$on("partyup.hostedEvent",function(e,t){s.currentUser&&s.currentUser.recentlyHostedEvents.unshift(t)}),e.$on("partyup.joinedEvent",function(e,t){s.currentUser&&s.currentUser.recentlyJoinedEvents.unshift(t)}),e.$on("$stateChangeStart",function(){s.goBack=!1}),s.hostEvent=function(e){i("sideNav").close();var t=o.confirm().parent(angular.element(document.body)).title("Host Again?").content("Would you like to host this event again?").ariaLabel("Host Event Again").ok("OK").cancel("Cancel");o.show(t).then(function(){n.go("mission",{communityId:e.mission.communityId,missionId:e.mission.id,host:!0})})},s.findEvents=function(e){i("sideNav").close(),n.go("mission",{communityId:e.mission.communityId,missionId:e.mission.id})},a()}angular.module("partyUp").controller("HeaderCtrl",e),e.$inject=["$scope","UserService","$state","$mdSidenav","$mdDialog"]}(),function(){"use strict";function e(e,t,n,i){var o=this;o.username="",o.password="",i.hideLoading(),n.getCurrentUser().then(function(e){console.log(e),i.showAlert("success","Already Logged In!",""),t.go("communities")}),o.submit=function(){i.showLoading("Logging you in..."),n.login(o.username,o.password).then(function(e){i.hideLoading(),i.showAlert("success","Hello "+e.user.firstName,""),t.go("communities")},function(){i.showAlert("warning","Uh Oh!","Could not log you in!")})},o.createAccount=function(){t.go("register")}}angular.module("partyUp").controller("LoginCtrl",e),e.$inject=["$http","$state","UserService","AlertService"]}(),function(){"use strict";function e(e,t){t.logout(),e.go("communities")}angular.module("partyUp").controller("LogoutCtrl",e),e.$inject=["$state","UserService"]}(),function(){"use strict";function e(e,t,n,i,o,a){function r(){t.showLoading("Fetching mission..."),t.updateTitle("Admin - Mission..."),t.updateGoBack(s.backToCommunity),e.getById(n.missionId).then(function(e){t.hideLoading(),s.mission=e.data,t.updateTitle("Admin - "+s.mission.name)},function(){t.hideLoading(),t.showAlert("error","Uh oh","Could not find mission")})}var s=this;s.modelOptions={debounce:{"default":500,blur:0}},s.uploadFile=function(e,n){t.showAlert("info","Upload Started",""),i.uploadFile(e[0]).then(function(e){switch(n){case"logo":s.mission.logoUrl=e.data[0].uri;break;case"banner":s.mission.bannerUrl=e.data[0].uri}s.update()},function(){t.showAlert("error","Failed","Failed to upload file")})},s.update=function(){e.update(s.mission).then(function(e){t.showAlert("success","Success","Mission Updated")},function(){t.showAlert("error","Error","Mission could not be updated")})},s.backToCommunity=function(){a.go("admin.community",{communityId:n.communityId})},s["delete"]=function(){var i=o.confirm().parent(angular.element(document.body)).title("Are you sure?").content("Are you sure you want to delete this mission?").ariaLabel("Delete Mission").ok("OK").cancel("Cancel").targetEvent(event);o.show(i).then(function(){e["delete"](s.mission.id).then(function(){t.showAlert("success","Success!","Mission has been deleted"),a.go("admin.community",{communityId:n.communityId})},function(e){t.showAlert("error","Failed","Failed to delete mission")})})},r()}angular.module("partyUp").controller("MissionAdminCtrl",e),e.$inject=["MissionsService","AlertService","$stateParams","FilesService","$mdDialog","$state"]}(),function(){"use strict";function e(e,t,n,i,o,a,r,s,l,c,m){function u(){a.updateTitle("Mission..."),a.updateGoBack(b),a.showLoading("Fetching mission..."),i.getById(s.missionId).then(d,function(){a.hideLoading(),a.showAlert("error","Uh oh","Could not find mission")})}function d(e){w.mission=e.data,a.hideLoading(),a.updateTitle(w.mission.name),o.getAllByMission(s.missionId).then(p,function(){a.hideLoading(),a.showAlert("error","Uh oh","Could not find mission")})}function p(e){w.events=e.data,g(),r.startConnection().then(function(){w.allowHosting=!0,A.server.joinMissionGroup(s.missionId),angular.isDefined(s.host)&&"true"===s.host&&w.hostEvent()})}function g(e){angular.forEach(w.events,function(e){e.timeAgo=m.utc(e.createdOn).fromNow()}),e&&n.$apply()}function h(e){c.show({controller:f,templateUrl:"amountModal.html",parent:angular.element(document.body),targetEvent:e}).then(function(e){v(e)})}function f(e,t){e.platform="Xbox One",e.platforms=["Xbox 360","Xbox One","Playstation 3","Playstation 4"],e.amount=1,e.possibleAmounts=[1,2,3,4,5,6,7,8,9,10],e.language="English",e.languages=["English","Spanish","French","German"],e.mic=!0,e.notes="",e.cancel=function(){t.cancel()},e.complete=function(){t.hide({platform:e.platform,desiredAmount:e.amount?e.amount:1,language:e.language?e.language:e.languages[0],hasMic:e.mic,notes:e.notes})}}function v(e){w.allowHosting?A.server.hostEvent(s.missionId,e):a.showAlert("warning","Just a sec","Still establishing a connection")}function y(e){l.go("event",{communityId:s.communityId,missionId:s.missionId,eventId:e.id})}function b(){l.go("community",{communityId:s.communityId})}var w=this;w.events=!1,w.allowHosting=!1,w.play=!0;var A=r.getHub("events"),U=[];A.client.newHostedEvent=function(e){if(!w.play)return void U.push(e);for(var t=!1,n=0;n<w.events.length;n++)if(w.events[n].id===e.id){t=!0;break}t||w.events===!1||(w.events.unshift(e),g(!0))},w.togglePlay=function(){if(w.play=!w.play,w.play){for(var e=U.length-1;e>=0;e--)w.events.push(U[e]),0===e&&(U=[]);g(!1)}},A.client.removeEvent=function(t){for(var i=-1,o=0;o<w.events.length;o++)if(w.events[o].id===t.id){i=o;break}-1!==i&&(w.events[i].closed=!0,n.$apply(),e(function(){w.events.splice(i,1),n.$apply()},2e3));for(var a=-1,r=0;r<U.length;r++)if(U[r].id===t.id){a=r;break}-1!==a&&U.splice(i,1)},A.client.updateLookingForCount=function(e,t){for(var i=0;i<w.events.length;i++)if(w.events[i].id===e.id){w.events[i].DesiredAmount=t,n.$apply();break}for(var o=0;o<U.length;o++)if(U[o].id===e.id){U[o].DesiredAmount=t,n.$apply();break}},A.client.eventCreated=function(e){a.showAlert("success","Created","Event Created!"),y(e)},w.hostEvent=function(e){t.getCurrentUser().then(function(){h(e)},function(){t.showLoginModal(e).then(function(){window.location.reload()})})},w.platforms=["All Platforms","Xbox 360","Xbox One","Playstation 3","Playstation 4"],w.platform=w.platforms[0],w.platformFilter="*",w.filterPlatform=function(e){w.platformFilter="All Platforms"===e?"*":e},w.joinEvent=function(e){t.getCurrentUser().then(function(t){y(e)},function(){a.showAlert("error","Who Are You?","Sorry, you must be logged in to join events"),l.go("login")})},u()}angular.module("partyUp").controller("MissionCtrl",e),e.$inject=["$timeout","UserService","$scope","MissionsService","EventsService","AlertService","SignalRService","$stateParams","$state","$mdDialog","moment"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{mission:"=mission",whenClicked:"&"},templateUrl:"/client/app/mission/missionCard.tmpl.html",link:function(e,t,n){e.clicked=function(){e.whenClicked()(e.mission)}}}}angular.module("partyUp").directive("missionCard",e),e.$inject=[]}(),function(){"use strict";function e(e,t){var n={},i=e+"/communities",o=e+"/missions";return n.getAllByCommunity=function(e){return t.get(i+"/"+e+"/missions")},n.getById=function(e){return t.get(o+"/"+e)},n.update=function(e){return t.put(o+"/"+e.id,e)},n.createNew=function(e){return t.post(i+"/"+e+"/missions/createnew",{name:"New Mission",description:"",logoUrl:"",bannerUrl:"",createdOn:new Date,modifiedOn:new Date})},n["delete"]=function(e){return t["delete"](o+"/"+e)},n.search=function(e,n){return t.get(i+"/"+e+"/missions/search?q="+encodeURI(n))},n}angular.module("partyUp").service("MissionsService",e),e.$inject=["API_URL","$http"]}(),function(){"use strict";function e(e,t,n){var i=this;i.user={username:"",firstName:"",lastName:"",email:"",XBLTag:"",PSNTag:"",steamTag:"",password:"",confirmPassword:""},n.updateTitle("Register"),i.usernameOk=!0,i.checkUsername=function(e){t.checkUsername(e).then(function(e){i.usernameOk="OK"===e.data?!0:!1},function(){i.usernameOk=!1})},i.emailOk=!0,i.checkEmail=function(e){t.checkEmail(e).then(function(e){i.emailOk="OK"===e.data?!0:!1},function(){i.emailOk=!1})},i.submit=function(){n.showLoading("Registering User..."),i.user.username.trim(),i.user.firstName.trim(),i.user.lastName.trim(),i.user.email.trim(),i.user.XBLTag.trim(),i.user.PSNTag.trim(),i.user.steamTag.trim(),t.register(i.user).then(function(o){n.showAlert("success","Account Created!",""),t.login(i.user.username,i.user.password).then(function(t){n.hideLoading(),e.go("communities")},function(){n.hideLoading(),n.showAlert("warning","Uh Oh!","Could not create your account")})},function(){n.hideLoading(),n.showAlert("warning","Uh Oh!","Could not create your account")})}}angular.module("partyUp").controller("RegisterCtrl",e),e.$inject=["$state","UserService","AlertService"]}(),angular.module("partyUp").run(["$templateCache",function(e){e.put("about/about.tmpl.html",'<md-content layout-padding layout-align="center center"><div layout-padding><p>Party Up is proudly created and updated by <strong><a href=http://gentryriggen.com target=#>Gentry Riggen</a></strong></p><p>The site is always looking for ways to improve and new communities to support. If you are interested in either, please submit feedback below.</p></div><md-card><md-toolbar><div class=md-toolbar-tools><span flex class=organizer>Send Feedback</span></div></md-toolbar><md-card-content><form name=feedback><md-input-container><label>Name</label> <input required name=name ng-model=About.user.name></md-input-container><md-input-container><label>Email</label> <input required name=email ng-model=About.user.email></md-input-container><md-input-container><label>Message</label> <textarea required name=message ng-model=About.user.message></textarea></md-input-container></form></md-card-content><div class=md-actions layout=row layout-align="end center"><md-button ng-click=About.submit() class="md-raised md-accent">Send Feedback</md-button></div></md-card></md-content>'),e.put("account/account.tmpl.html",'<md-card flex-sm=100 flex-gt-sm><md-toolbar><div class=md-toolbar-tools><span flex class=organizer>Account Details</span></div></md-toolbar><md-card-content><form name=register><md-input-container><label>Username</label> <input required name=username ng-model=Account.user.userName ng-model-options="{ debounce: 250, blur: 0 }" ng-change=Account.checkUsername(Account.user.userName)><div ng-messages=register.username.$error class=input-error ng-if=!Account.usernameOk role=alert><div>Username Already In Use!</div></div></md-input-container><md-input-container><label>First Name</label> <input required name=firstname ng-model=Account.user.firstName></md-input-container><md-input-container><label>Last Name</label> <input required name=lastname ng-model=Account.user.lastName></md-input-container><md-input-container><label>Email</label> <input type=email name=email ng-model=Account.user.email ng-model-options="{ debounce: 250, blur: 0 }" ng-change=Account.checkEmail(Account.user.email)><div ng-messages=register.email.$error class=input-error ng-if=!Account.emailOk role=alert><div>Email Already In Use!</div></div></md-input-container><md-input-container><label>Xbox Live Gamertag</label> <input name=xbl ng-model=Account.user.xblTag></md-input-container><md-input-container><label>Playstation Network Gamertag</label> <input name=psn ng-model=Account.user.psnTag></md-input-container><md-input-container><label>Steam Gamertag</label> <input name=steam ng-model=Account.user.steamTag></md-input-container></form></md-card-content><div class=md-actions layout=row layout-align="end center"><md-button ng-click=Account.update() class="md-raised md-accent" ng-disabled=!Account.usernameOk>Save Info</md-button></div></md-card>'),e.put("admin/admin.tmpl.html",'<div layout=row><md-button ng-repeat="section in Admin.sections" ng-class="{\'md-primary\': Admin.selectedState.state == section.state}" ng-click=Admin.goTo(section)>{{section.title}}</md-button></div><ui-view></ui-view>'),e.put("community/communities.admin.tmpl.html",'<md-button class="md-raised md-accent" ng-click=CommunitiesAdmin.createNew()>Create New</md-button><br><br><div layout=row layout-wrap><community-card flex=100 ng-repeat="c in CommunitiesAdmin.communities" community=c when-clicked=CommunitiesAdmin.goToCommunity></community-card></div>'),e.put("community/communities.tmpl.html",'<div layout=row layout-wrap layout-padding><community-card ng-repeat="c in Communities.communities" community=c when-clicked=Communities.goToCommunity></community-card></div>'),e.put("community/community.admin.tmpl.html",'<div layout=row><span flex></span><md-button class="md-raised md-warn" ng-click=CommunityAdmin.delete()>Delete</md-button></div><md-input-container><label>Name</label> <input ng-model=CommunityAdmin.community.name ng-change=CommunityAdmin.update() ng-model-options=CommunityAdmin.modelOptions></md-input-container><md-input-container><label>Description</label> <input ng-model=CommunityAdmin.community.description ng-change=CommunityAdmin.update() ng-model-options=CommunityAdmin.modelOptions></md-input-container><md-input-container><label>Logo Url</label> <input type=file name=file onchange="angular.element(this).scope().CommunityAdmin.uploadFile(this.files, \'banner\')"> <img src={{CommunityAdmin.community.bannerUrl}} height=90 width=160></md-input-container><md-divider></md-divider><div layout=row><h4>Missions</h4><span flex></span><md-button class="md-raised md-primary" ng-click=CommunityAdmin.createNewMission()>New Mission</md-button></div><br><br><div layout=row layout-wrap><mission-card flex=100 ng-repeat="m in CommunityAdmin.missions" mission=m when-clicked=CommunityAdmin.goToMission></mission-card></div>'),
e.put("community/community.tmpl.html",'<div class=page><div class=title><div style="background-image: url(\'{{ Community.community.bannerUrl }}\')" class=page-banner></div><h1>{{Community.community.name}}</h1></div><div layout=column><div layout=row class=search-form><form flex=100 name=searchForm ng-submit=Community.search(q)><md-input-container><label>Search Missions</label> <input ng-model=q ng-model-options="{ debounce: 350, blur: 0 }" ng-change=Community.search(q)></md-input-container><i class="fa fa-search"></i></form></div><table class="table table-striped mission-listings"><thead><tr><th>Name</th><th>Total Events</th></tr></thead><tbody><tr ng-repeat="m in Community.missions" ng-click=Community.goToMission(m)><td>{{m.name}}</td><td>{{m.totalEvents}}</td></tr></tbody></table></div></div>'),e.put("community/communityCard.tmpl.html",'<div class=community-card ng-click=clicked()><img src={{community.logoUrl}} alt="community logo - {{community.name}}"><h2>{{community.name}}</h2></div>'),e.put("common/loginModal.tmpl.html",'<md-dialog aria-label="Party Up Login"><form><md-toolbar><div class=md-toolbar-tools><h2>Login</h2></div></md-toolbar><md-dialog-content><md-input-container><label>Username</label> <input type=text ng-model=user.username required></md-input-container><md-input-container><label>Password</label> <input type=password ng-model=user.password required></md-input-container></md-dialog-content><div class=md-actions layout=row layout-align="end center"><md-button ng-click=cancel()>Cancel</md-button><md-button ng-click=createAccount() class=md-raised>New Account</md-button><md-button ng-click=submit() class="md-raised md-accent">Login</md-button></div></form></md-dialog>'),e.put("mission/mission.admin.tmpl.html",'<md-content layout-padding><div layout=row><md-button class="md-raised md-warn" ng-click=MissionAdmin.delete()>Delete</md-button></div><md-input-container><label>Name</label> <input ng-model=MissionAdmin.mission.name ng-change=MissionAdmin.update() ng-model-options=MissionAdmin.modelOptions></md-input-container><md-input-container><label>Description</label> <input ng-model=MissionAdmin.mission.description ng-change=MissionAdmin.update() ng-model-options=MissionAdmin.modelOptions></md-input-container><md-input-container><label>Logo Url</label> <input type=file name=file onchange="angular.element(this).scope().MissionAdmin.uploadFile(this.files, \'banner\')"> <img src={{MissionAdmin.mission.bannerUrl}} height=90 width=160></md-input-container></md-content>'),e.put("mission/mission.tmpl.html",'<div class=page><div class=title><div style="background-image: url(\'{{ Mission.mission.bannerUrl }}\')" class=page-banner></div><h1>{{Mission.mission.name}}</h1><p>{{Mission.mission.description}}</p></div><div layout=row><h2>Events <small>({{Mission.events.length}})</small></h2><span flex></span><md-button class=md-raised ng-click=Mission.togglePlay()><i class="fa fa-play" ng-hide=Mission.play></i> <i class="fa fa-pause" ng-show=Mission.play></i> {{Mission.play ? \'Pause\' : \'Play\'}}</md-button><md-button class="md-raised md-accent" ng-click=Mission.hostEvent($event)>Host Event</md-button></div><md-divider></md-divider><div layout=row class=event-filters><div layout=column class=filter><label>Platform:</label><md-input-container><md-select placeholder=Platform ng-model=Mission.platform ng-change=Mission.filterPlatform(Mission.platform)><md-option ng-repeat="p in Mission.platforms" value={{p}}>{{p}}</md-option></md-select></md-input-container></div></div><md-divider></md-divider><div layout=column layout-wrap><md-progress-linear class=md-accent md-mode=indeterminate ng-show="Mission.events.length == 0 && Mission.play"></md-progress-linear><div ng-show="Mission.events.length == 0"><h4>No events. Why not host one?</h4><strong>(No need to refresh, new events will show up as they are created)</strong></div><table class="table table-striped" ng-show="Mission.events.length > 0"><thead><tr><th>Username</th><th>Platform</th><th>Time</th><th hide-sm>Amount</th><th hide-sm>Language</th><th hide-sm>Mic?</th></tr></thead><tbody><tr ng-repeat="event in Mission.events | platformFilter:Mission.platformFilter" ng-click=Mission.joinEvent(event)><td style="text-transform: uppercase;">{{event.organizer.username}}</td><td>{{event.platform}}</td><td>{{event.timeAgo}}</td><td hide-sm>{{event.desiredAmount}}</td><td hide-sm>{{event.language}}</td><td hide-sm>{{event.hasMic ? \'YES\' : \'NO\'}}</td></tr></tbody></table></div></div><script type=text/ng-template id=amountModal.html><md-dialog aria-label="Event Details" class="event-details-modal"> <form ng-submit="complete()"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Event Details</h2> </div> </md-toolbar> <md-dialog-content layout="column"> <label>Platform</label> <md-input-container> <md-select placeholder="Platform" ng-model="platform"> <md-option ng-repeat="p in platforms" value="{{p}}">{{p}}</md-option> </md-select> </md-input-container> <label>How many do you need?</label> <md-input-container> <md-select placeholder="How Many?" ng-model="amount"> <md-option ng-repeat="amt in possibleAmounts" value="{{amt}}">{{amt}}</md-option> </md-select> </md-input-container> <label>Language</label> <md-input-container> <md-select placeholder="Language?" ng-model="language"> <md-option ng-repeat="l in languages" value="{{l}}">{{l}}</md-option> </md-select> </md-input-container> <md-input-container> <md-checkbox ng-model="mic" aria-label="Mic?"> Need a mic? </md-checkbox> </md-input-container> <md-input-container> <label>Notes</label> <input type="text" ng-model="notes" /> </md-input-container> </md-dialog-content> <div class="md-actions" layout="row"> <md-button ng-click="cancel()" class="md-raised"> Cancel </md-button> <md-button type="submit" class="md-raised md-accent"> OK </md-button> </div> </form> </md-dialog></script>'),e.put("mission/missionCard.tmpl.html",'<md-card class=mission-card><md-toolbar><div class=md-toolbar-tools><h2><span>{{mission.name}}</span></h2></div></md-toolbar><md-card-content><p>{{mission.description}}</p></md-card-content><div class=md-actions layout=row layout-align="end center"><md-button class="md-raised md-accent" aria-label="Join Event" ng-click=clicked()>Find A Game</md-button></div></md-card>'),e.put("event/event.tmpl.html",'<md-content layout-sm=column class=event-page><div class=status><h4>Event Status: <small>{{Event.status}}</small></h4></div><md-card class=teammates><md-toolbar><div class=md-toolbar-tools><span flex class=organizer>Teammates</span></div></md-toolbar><md-card-content><md-list><md-subheader class=md-no-sticky>Organizer</md-subheader><md-list-item class=md-3-line><img src=http://cdn.gentryriggen.com/partyup/avatar.png class=md-avatar alt=Organizer><div class=md-list-item-text><h3>{{ Event.event.organizer.username }}</h3><p class=xbl ng-if=Event.event.organizer.xblTag><a ng-click=Event.showXBLInfo(Event.event.organizer) target=_blank><strong>XBL:</strong> {{ Event.event.organizer.xblTag }}</a></p><p class=psn>PSN: {{Event.event.organizer.psnTag}}</p></div></md-list-item><md-subheader class=md-no-sticky>Participants</md-subheader><md-progress-linear class=md-accent md-mode=indeterminate ng-show="Event.event.eventParticipants.length < Event.event.desiredAmount"></md-progress-linear><md-list-item class=md-3-line ng-repeat="p in Event.event.eventParticipants"><img src=http://cdn.gentryriggen.com/partyup/avatar.png class=md-avatar alt=Organizer><div class=md-list-item-text><h3>{{ p.username }}</h3><p class=xbl><a ng-click=Event.showXBLInfo(p) target=_blank><strong>XBL:</strong> {{ p.xblTag }}</a></p><p class=psn>PSN: {{p.psnTag}}</p></div></md-list-item></md-list></md-card-content></md-card><md-card class=team-chat><md-toolbar><div class=md-toolbar-tools><span flex class=organizer>Team Chat</span></div></md-toolbar><md-card-content><ul><li ng-repeat="chat in Event.chatMessages | limitTo:-8"><strong>{{ chat.from }}:</strong> <span>{{ chat.message }}</span></li></ul><form flex ng-submit=Event.addNewMessage()><md-input-container><label>New Message</label> <input ng-model=Event.newMessage></md-input-container></form></md-card-content></md-card></md-content>'),e.put("event/eventCard.tmpl.html",'<md-card class=event><md-toolbar><div class=md-toolbar-tools><span flex class=organizer>{{event.organizer.username}} <small>on</small> {{event.platform}}</span> <span flex=40 style="text-align: right;">{{event.timeAgo}}</span></div></md-toolbar><md-card-content><p><b>{{event.organizer.username}}</b> is looking for <b>{{event.desiredAmount > 1 ? event.desiredAmount + \' people \' : \'1 person \'}}</b> to help conquer <b>{{event.mission.name}}</b>. <b>{{event.organizer.username}}</b> speaks <b>{{event.language}}</b> {{event.hasMic ? \'and has a mic.\' : \'but does not have a mic.\'}}</p><p ng-if="event.notes.length > 0"><b>{{event.organizer.username}}</b> would also like you to know:</p><p ng-if="event.notes.length > 0"><b><i>{{event.notes}}</i></b></p></md-card-content><div class=md-actions layout=row layout-align="end center"><md-button ng-hide=event.closed class="md-raised md-accent" aria-label="Join Event" ng-click=clicked()>Join</md-button><h3 ng-show=event.closed>Closed!</h3></div></md-card>'),e.put("register/register.tmpl.html",'<md-card flex-sm=100 flex-gt-sm><md-toolbar><div class=md-toolbar-tools><span flex class=organizer>New Account</span></div></md-toolbar><md-card-content><form name=register><md-input-container><label>Username</label> <input name=username ng-model=Register.user.username ng-model-options="{ debounce: 250, blur: 0 }" ng-change=Register.checkUsername(Register.user.username) required pattern=[a-zA-Z0-9]+ novalidate><div ng-show=register.username.$touched class=input-error role=alert><p ng-if=register.username.$error.required>Username is required</p><p ng-if=register.username.$error.pattern>Alphanumeric characters only</p></div><div class=input-error ng-if=!Register.usernameOk role=alert><div>Username Already In Use!</div></div></md-input-container><md-input-container><label>First Name</label> <input name=firstname ng-model=Register.user.firstName pattern=[a-zA-Z]+ required novalidate><div ng-show=register.firstname.$touched class=input-error role=alert><p ng-if=register.firstname.$error.required>First Name is required</p><p ng-if=register.firstname.$error.pattern>Bruh, letters only please</p></div></md-input-container><md-input-container><label>Last Name</label> <input name=lastname ng-model=Register.user.lastName pattern=[a-zA-Z]+ required novalidate><div ng-show=register.lastname.$touched class=input-error role=alert><p ng-if=register.lastname.$error.required>Last Name is required</p><p ng-if=register.lastname.$error.pattern>Bruh, letters only please</p></div></md-input-container><md-input-container><label>Email</label> <input type=email name=email ng-model=Register.user.email ng-model-options="{ debounce: 250, blur: 0 }" ng-change=Register.checkEmail(Register.user.email) required><div ng-show=register.email.$touched class=input-error role=alert><p ng-if=register.email.$error.required>Username is required</p><p ng-if=register.email.$error.email>Incorrect email address</p></div><div class=input-error ng-if=!Register.emailOk role=alert><div>Email Already In Use!</div></div></md-input-container><md-input-container><label>Xbox Live Gamertag</label> <input name=xbl ng-model=Register.user.XBLTag></md-input-container><md-input-container><label>Playstation Network Gamertag</label> <input name=psn ng-model=Register.user.PSNTag></md-input-container><md-input-container><label>Steam Gamertag</label> <input name=steam ng-model=Register.user.steamTag></md-input-container><md-input-container><label>Password</label> <input type=password required name=password ng-model=Register.user.password ng-minlength=6><div ng-show=register.password.$touched class=input-error role=alert><p ng-if=register.password.$error.minlength>Your password is weak sauce</p></div></md-input-container></form></md-card-content><div class=md-actions layout=row layout-align="end center"><md-button ng-click=Register.submit() class="md-raised md-accent" ng-disabled="!register.$valid !Register.usernameOk && !Register.emailOk">Create Account</md-button></div></md-card>'),e.put("login/login.tmpl.html",'<md-content layout-padding layout=row><span flex></span><form flex-sm=80 flex-gt-sm=50 name=login ng-submit=Login.submit()><md-input-container><label>Username</label> <input required name=username ng-model=Login.username></md-input-container><md-input-container><label>Password</label> <input type=password required name=password ng-model=Login.password></md-input-container><md-input-container><md-button type=submit class="md-raised md-accent">Log In</md-button></md-input-container></form><span flex></span></md-content><md-content layout layout-align="center start"><md-button class=md-primary ng-click=Login.createAccount()>Create New Account</md-button></md-content>')}]);